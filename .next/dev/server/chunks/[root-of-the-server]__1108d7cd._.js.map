{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 100, "column": 0}, "map": {"version":3,"sources":["file:///home/zen/Downloads/event-platform-build/lib/db-adapter.ts"],"sourcesContent":["import { PrismaClient } from \"@prisma/client\"\n\nconst prismaClientSingleton = () => {\n  return new PrismaClient()\n}\n\ndeclare global {\n  var prisma: undefined | ReturnType<typeof prismaClientSingleton>\n}\n\nconst prisma = globalThis.prisma ?? prismaClientSingleton()\n\nif (process.env.NODE_ENV !== \"production\") globalThis.prisma = prisma\n\nexport const db = {\n  event: {\n    create: async (data: any) => {\n      return prisma.event.create({ data })\n    },\n    findUnique: async (where: { id: string }) => {\n      return prisma.event.findUnique({ where })\n    },\n    findMany: async (options?: any) => {\n      return prisma.event.findMany({\n        orderBy: { createdAt: 'desc' },\n        ...options\n      })\n    },\n    update: async (params: { where: { id: string }; data: any }) => {\n      return prisma.event.update({\n        where: params.where,\n        data: params.data,\n      })\n    },\n    findUniqueWithClaims: async (where: { id: string }) => {\n      return prisma.event.findUnique({\n        where,\n        include: { claimedSeats: true },\n      })\n    },\n    findManyWithClaims: async () => {\n      return prisma.event.findMany({\n        include: { claimedSeats: true },\n        orderBy: { createdAt: 'desc' },\n      })\n    },\n  },\n  claimedSeat: {\n    create: async (data: any) => {\n      return prisma.claimedSeat.create({ data })\n    },\n    findFirst: async (where: any) => {\n      return prisma.claimedSeat.findFirst({ where })\n    },\n  },\n}\n"],"names":[],"mappings":";;;;AAAA;;AAEA,MAAM,wBAAwB;IAC5B,OAAO,IAAI,+JAAY;AACzB;AAMA,MAAM,SAAS,WAAW,MAAM,IAAI;AAEpC,wCAA2C,WAAW,MAAM,GAAG;AAExD,MAAM,KAAK;IAChB,OAAO;QACL,QAAQ,OAAO;YACb,OAAO,OAAO,KAAK,CAAC,MAAM,CAAC;gBAAE;YAAK;QACpC;QACA,YAAY,OAAO;YACjB,OAAO,OAAO,KAAK,CAAC,UAAU,CAAC;gBAAE;YAAM;QACzC;QACA,UAAU,OAAO;YACf,OAAO,OAAO,KAAK,CAAC,QAAQ,CAAC;gBAC3B,SAAS;oBAAE,WAAW;gBAAO;gBAC7B,GAAG,OAAO;YACZ;QACF;QACA,QAAQ,OAAO;YACb,OAAO,OAAO,KAAK,CAAC,MAAM,CAAC;gBACzB,OAAO,OAAO,KAAK;gBACnB,MAAM,OAAO,IAAI;YACnB;QACF;QACA,sBAAsB,OAAO;YAC3B,OAAO,OAAO,KAAK,CAAC,UAAU,CAAC;gBAC7B;gBACA,SAAS;oBAAE,cAAc;gBAAK;YAChC;QACF;QACA,oBAAoB;YAClB,OAAO,OAAO,KAAK,CAAC,QAAQ,CAAC;gBAC3B,SAAS;oBAAE,cAAc;gBAAK;gBAC9B,SAAS;oBAAE,WAAW;gBAAO;YAC/B;QACF;IACF;IACA,aAAa;QACX,QAAQ,OAAO;YACb,OAAO,OAAO,WAAW,CAAC,MAAM,CAAC;gBAAE;YAAK;QAC1C;QACA,WAAW,OAAO;YAChB,OAAO,OAAO,WAAW,CAAC,SAAS,CAAC;gBAAE;YAAM;QAC9C;IACF;AACF"}},
    {"offset": {"line": 203, "column": 0}, "map": {"version":3,"sources":["file:///home/zen/Downloads/event-platform-build/lib/pdf-generator.ts"],"sourcesContent":["import { jsPDF } from \"jspdf\"\nimport QRCode from \"qrcode\"\n\nexport async function generateTicketPDF(\n  eventTitle: string,\n  seatInfo: string,\n  eventDateTime: string,\n  location: string,\n  ticketId: string,\n): Promise<Buffer> {\n  // Generate QR code\n  const qrCodeData = await QRCode.toDataURL(ticketId)\n\n  // Create PDF\n  const pdf = new jsPDF({\n    orientation: \"portrait\",\n    unit: \"mm\",\n    format: \"a4\",\n  })\n\n  // Set colors\n  pdf.setFillColor(25, 118, 210) // Blue background\n  pdf.rect(0, 0, 210, 50, \"F\")\n\n  // Title\n  pdf.setTextColor(255, 255, 255)\n  pdf.setFontSize(24)\n  pdf.text(eventTitle, 20, 20)\n  pdf.text(\"EVENT TICKET\", 20, 30)\n\n  // Reset text color\n  pdf.setTextColor(0, 0, 0)\n\n  // Event details\n  pdf.setFontSize(12)\n  pdf.text(`Seat: ${seatInfo}`, 20, 60)\n  pdf.text(`Date & Time: ${eventDateTime}`, 20, 75)\n  pdf.text(`Location: ${location}`, 20, 90)\n  pdf.text(`Ticket ID: ${ticketId}`, 20, 105)\n\n  // Add QR code\n  pdf.addImage(qrCodeData, \"PNG\", 130, 60, 50, 50)\n\n  // Footer\n  pdf.setFontSize(10)\n  pdf.setTextColor(100, 100, 100)\n  pdf.text(\"Please present this ticket when entering the venue.\", 20, 180)\n\n  return Buffer.from(pdf.output(\"arraybuffer\"))\n}\n"],"names":[],"mappings":";;;;AAAA;AACA;;;AAEO,eAAe,kBACpB,UAAkB,EAClB,QAAgB,EAChB,aAAqB,EACrB,QAAgB,EAChB,QAAgB;IAEhB,mBAAmB;IACnB,MAAM,aAAa,MAAM,mJAAM,CAAC,SAAS,CAAC;IAE1C,aAAa;IACb,MAAM,MAAM,IAAI,gKAAK,CAAC;QACpB,aAAa;QACb,MAAM;QACN,QAAQ;IACV;IAEA,aAAa;IACb,IAAI,YAAY,CAAC,IAAI,KAAK,MAAK,kBAAkB;IACjD,IAAI,IAAI,CAAC,GAAG,GAAG,KAAK,IAAI;IAExB,QAAQ;IACR,IAAI,YAAY,CAAC,KAAK,KAAK;IAC3B,IAAI,WAAW,CAAC;IAChB,IAAI,IAAI,CAAC,YAAY,IAAI;IACzB,IAAI,IAAI,CAAC,gBAAgB,IAAI;IAE7B,mBAAmB;IACnB,IAAI,YAAY,CAAC,GAAG,GAAG;IAEvB,gBAAgB;IAChB,IAAI,WAAW,CAAC;IAChB,IAAI,IAAI,CAAC,CAAC,MAAM,EAAE,UAAU,EAAE,IAAI;IAClC,IAAI,IAAI,CAAC,CAAC,aAAa,EAAE,eAAe,EAAE,IAAI;IAC9C,IAAI,IAAI,CAAC,CAAC,UAAU,EAAE,UAAU,EAAE,IAAI;IACtC,IAAI,IAAI,CAAC,CAAC,WAAW,EAAE,UAAU,EAAE,IAAI;IAEvC,cAAc;IACd,IAAI,QAAQ,CAAC,YAAY,OAAO,KAAK,IAAI,IAAI;IAE7C,SAAS;IACT,IAAI,WAAW,CAAC;IAChB,IAAI,YAAY,CAAC,KAAK,KAAK;IAC3B,IAAI,IAAI,CAAC,uDAAuD,IAAI;IAEpE,OAAO,OAAO,IAAI,CAAC,IAAI,MAAM,CAAC;AAChC"}},
    {"offset": {"line": 290, "column": 0}, "map": {"version":3,"sources":["file:///home/zen/Downloads/event-platform-build/lib/email.tsx"],"sourcesContent":["import nodemailer from \"nodemailer\"\n\n// Create a transporter\n// If no SMTP config is present, we'll log to console (mock mode)\nconst hasSmtpConfig = process.env.SMTP_HOST && process.env.SMTP_USER\n\nconst transporter = nodemailer.createTransport({\n  host: process.env.SMTP_HOST || \"localhost\",\n  port: Number.parseInt(process.env.SMTP_PORT || \"1025\"),\n  secure: process.env.SMTP_SECURE === \"true\",\n  auth:\n    process.env.SMTP_USER && process.env.SMTP_PASSWORD\n      ? {\n          user: process.env.SMTP_USER,\n          pass: process.env.SMTP_PASSWORD,\n        }\n      : undefined,\n})\n\nexport async function sendTicketEmail(to: string, ticketPath: string, eventTitle: string, seatInfo: string) {\n  console.log(`Attempting to send email to ${to} for event ${eventTitle}`)\n\n  if (!hasSmtpConfig) {\n    console.warn(\"⚠️ No SMTP configuration found. Email sending is mocked.\")\n    console.log(`\n      [MOCK EMAIL]\n      To: ${to}\n      Subject: Your Ticket for ${eventTitle}\n      Seat: ${seatInfo}\n      Ticket Path: ${ticketPath}\n    `)\n    return { accepted: [to], messageId: \"mock-id\" }\n  }\n\n  try {\n    const result = await transporter.sendMail({\n      from: process.env.EMAIL_FROM || '\"EventHub\" <noreply@eventhub.com>',\n      to,\n      subject: `Your Ticket for ${eventTitle}`,\n      html: `\n        <div style=\"font-family: sans-serif; max-width: 600px; margin: 0 auto;\">\n          <h1 style=\"color: #026cdf;\">Your Ticket for ${eventTitle}</h1>\n          <p>Thank you for claiming your seat!</p>\n          <div style=\"background: #f4f4f4; padding: 20px; border-radius: 8px; margin: 20px 0;\">\n            <p style=\"margin: 0; font-size: 18px;\"><strong>Seat:</strong> ${seatInfo}</p>\n          </div>\n          <p>Your ticket PDF is attached to this email.</p>\n          <p>Please present this ticket when entering the venue.</p>\n          <hr style=\"border: none; border-top: 1px solid #eee; margin: 30px 0;\" />\n          <p style=\"color: #888; font-size: 12px;\">EventHub Inc.</p>\n        </div>\n      `,\n      attachments: [\n        {\n          filename: `ticket-${eventTitle.replace(/\\s+/g, \"-\").toLowerCase()}.pdf`,\n          path: ticketPath,\n        },\n      ],\n    })\n    console.log(\"Email sent successfully:\", result.messageId)\n    return result\n  } catch (error) {\n    console.error(\"Failed to send email:\", error)\n    // We re-throw so the caller knows it failed, or we could return false\n    // For now, let's throw so the UI can show an error if needed, \n    // but often we might want to swallow this if the ticket was claimed successfully.\n    // Let's log and return null to indicate failure but not crash the request\n    return null\n  }\n}\n"],"names":[],"mappings":";;;;AAAA;;AAEA,uBAAuB;AACvB,iEAAiE;AACjE,MAAM,gBAAgB,QAAQ,GAAG,CAAC,SAAS,IAAI,QAAQ,GAAG,CAAC,SAAS;AAEpE,MAAM,cAAc,4JAAU,CAAC,eAAe,CAAC;IAC7C,MAAM,QAAQ,GAAG,CAAC,SAAS,IAAI;IAC/B,MAAM,OAAO,QAAQ,CAAC,QAAQ,GAAG,CAAC,SAAS,IAAI;IAC/C,QAAQ,QAAQ,GAAG,CAAC,WAAW,KAAK;IACpC,MACE,QAAQ,GAAG,CAAC,SAAS,IAAI,QAAQ,GAAG,CAAC,aAAa,GAC9C;QACE,MAAM,QAAQ,GAAG,CAAC,SAAS;QAC3B,MAAM,QAAQ,GAAG,CAAC,aAAa;IACjC,IACA;AACR;AAEO,eAAe,gBAAgB,EAAU,EAAE,UAAkB,EAAE,UAAkB,EAAE,QAAgB;IACxG,QAAQ,GAAG,CAAC,CAAC,4BAA4B,EAAE,GAAG,WAAW,EAAE,YAAY;IAEvE,IAAI,CAAC,eAAe;QAClB,QAAQ,IAAI,CAAC;QACb,QAAQ,GAAG,CAAC,CAAC;;UAEP,EAAE,GAAG;+BACgB,EAAE,WAAW;YAChC,EAAE,SAAS;mBACJ,EAAE,WAAW;IAC5B,CAAC;QACD,OAAO;YAAE,UAAU;gBAAC;aAAG;YAAE,WAAW;QAAU;IAChD;IAEA,IAAI;QACF,MAAM,SAAS,MAAM,YAAY,QAAQ,CAAC;YACxC,MAAM,QAAQ,GAAG,CAAC,UAAU,IAAI;YAChC;YACA,SAAS,CAAC,gBAAgB,EAAE,YAAY;YACxC,MAAM,CAAC;;sDAEyC,EAAE,WAAW;;;0EAGO,EAAE,SAAS;;;;;;;MAO/E,CAAC;YACD,aAAa;gBACX;oBACE,UAAU,CAAC,OAAO,EAAE,WAAW,OAAO,CAAC,QAAQ,KAAK,WAAW,GAAG,IAAI,CAAC;oBACvE,MAAM;gBACR;aACD;QACH;QACA,QAAQ,GAAG,CAAC,4BAA4B,OAAO,SAAS;QACxD,OAAO;IACT,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,yBAAyB;QACvC,sEAAsE;QACtE,+DAA+D;QAC/D,kFAAkF;QAClF,0EAA0E;QAC1E,OAAO;IACT;AACF"}},
    {"offset": {"line": 366, "column": 0}, "map": {"version":3,"sources":["file:///home/zen/Downloads/event-platform-build/app/api/events/%5Bid%5D/claim-seat/route.ts"],"sourcesContent":["import { type NextRequest, NextResponse } from \"next/server\"\nimport { db } from \"@/lib/db-adapter\"\nimport { generateTicketPDF } from \"@/lib/pdf-generator\"\nimport { sendTicketEmail } from \"@/lib/email\"\nimport fs from \"fs\"\nimport path from \"path\"\n\nexport async function POST(request: NextRequest, { params }: { params: Promise<{ id: string }> }) {\n  const { id } = await params\n  try {\n    const { seatRow, seatNum, email, name } = await request.json()\n\n    const ticketId = `TKT-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`\n\n    const existingClaim = await db.claimedSeat.findFirst({\n      eventId: id,\n      seatRow,\n      seatNum,\n    })\n\n    if (existingClaim) {\n      return NextResponse.json({ error: \"Seat already claimed\" }, { status: 400 })\n    }\n\n    const event = await db.event.findUnique({\n      id,\n    })\n\n    if (!event) {\n      return NextResponse.json({ error: \"Event not found\" }, { status: 404 })\n    }\n\n    const claim = await db.claimedSeat.create({\n      eventId: id,\n      seatRow,\n      seatNum,\n      email,\n      name,\n      ticketId,\n    })\n\n    const eventDateTime = `${event.date} at ${event.time}`\n    const seatInfo = `${seatRow}${seatNum}`\n\n    const pdfBuffer = await generateTicketPDF(event.title, seatInfo, eventDateTime, event.location, ticketId)\n\n    const ticketDir = path.join(process.cwd(), \"public\", \"tickets\")\n    if (!fs.existsSync(ticketDir)) {\n      fs.mkdirSync(ticketDir, { recursive: true })\n    }\n\n    const ticketFilePath = path.join(ticketDir, `${ticketId}.pdf`)\n    fs.writeFileSync(ticketFilePath, pdfBuffer)\n\n    // Send email\n    try {\n      await sendTicketEmail(email, ticketFilePath, event.title, `${seatRow}${seatNum}`) // Used ticketFilePath instead of ticketPath\n    } catch (error) {\n      console.error(\"Failed to send email (continuing anyway):\", error)\n      // We don't fail the request if email fails, as the seat is already claimed\n    }\n\n    return NextResponse.json({\n      success: true,\n      ticketId: claim.ticketId,\n      message: \"Seat claimed successfully\",\n    })\n  } catch (error) {\n    console.error(\"Failed to claim seat:\", error) // Updated error message\n    return NextResponse.json({ error: \"Failed to claim seat\" }, { status: 500 })\n  }\n}\n"],"names":[],"mappings":";;;;AAAA;AACA;AACA;AACA;AACA;AACA;;;;;;;AAEO,eAAe,KAAK,OAAoB,EAAE,EAAE,MAAM,EAAuC;IAC9F,MAAM,EAAE,EAAE,EAAE,GAAG,MAAM;IACrB,IAAI;QACF,MAAM,EAAE,OAAO,EAAE,OAAO,EAAE,KAAK,EAAE,IAAI,EAAE,GAAG,MAAM,QAAQ,IAAI;QAE5D,MAAM,WAAW,CAAC,IAAI,EAAE,KAAK,GAAG,GAAG,CAAC,EAAE,KAAK,MAAM,GAAG,QAAQ,CAAC,IAAI,MAAM,CAAC,GAAG,IAAI;QAE/E,MAAM,gBAAgB,MAAM,4HAAE,CAAC,WAAW,CAAC,SAAS,CAAC;YACnD,SAAS;YACT;YACA;QACF;QAEA,IAAI,eAAe;YACjB,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAuB,GAAG;gBAAE,QAAQ;YAAI;QAC5E;QAEA,MAAM,QAAQ,MAAM,4HAAE,CAAC,KAAK,CAAC,UAAU,CAAC;YACtC;QACF;QAEA,IAAI,CAAC,OAAO;YACV,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAkB,GAAG;gBAAE,QAAQ;YAAI;QACvE;QAEA,MAAM,QAAQ,MAAM,4HAAE,CAAC,WAAW,CAAC,MAAM,CAAC;YACxC,SAAS;YACT;YACA;YACA;YACA;YACA;QACF;QAEA,MAAM,gBAAgB,GAAG,MAAM,IAAI,CAAC,IAAI,EAAE,MAAM,IAAI,EAAE;QACtD,MAAM,WAAW,GAAG,UAAU,SAAS;QAEvC,MAAM,YAAY,MAAM,IAAA,8IAAiB,EAAC,MAAM,KAAK,EAAE,UAAU,eAAe,MAAM,QAAQ,EAAE;QAEhG,MAAM,YAAY,4GAAI,CAAC,IAAI,CAAC,QAAQ,GAAG,IAAI,UAAU;QACrD,IAAI,CAAC,wGAAE,CAAC,UAAU,CAAC,YAAY;YAC7B,wGAAE,CAAC,SAAS,CAAC,WAAW;gBAAE,WAAW;YAAK;QAC5C;QAEA,MAAM,iBAAiB,4GAAI,CAAC,IAAI,CAAC,WAAW,GAAG,SAAS,IAAI,CAAC;QAC7D,wGAAE,CAAC,aAAa,CAAC,gBAAgB;QAEjC,aAAa;QACb,IAAI;YACF,MAAM,IAAA,kIAAe,EAAC,OAAO,gBAAgB,MAAM,KAAK,EAAE,GAAG,UAAU,SAAS,GAAE,4CAA4C;QAChI,EAAE,OAAO,OAAO;YACd,QAAQ,KAAK,CAAC,6CAA6C;QAC3D,2EAA2E;QAC7E;QAEA,OAAO,gJAAY,CAAC,IAAI,CAAC;YACvB,SAAS;YACT,UAAU,MAAM,QAAQ;YACxB,SAAS;QACX;IACF,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,yBAAyB,QAAO,wBAAwB;QACtE,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAAuB,GAAG;YAAE,QAAQ;QAAI;IAC5E;AACF"}}]
}