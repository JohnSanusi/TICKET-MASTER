{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 100, "column": 0}, "map": {"version":3,"sources":["file:///home/zen/Downloads/event-platform-build/lib/db-adapter.ts"],"sourcesContent":["import { PrismaClient } from \"@prisma/client\"\n\nconst prismaClientSingleton = () => {\n  return new PrismaClient()\n}\n\ndeclare global {\n  var prisma: undefined | ReturnType<typeof prismaClientSingleton>\n}\n\nconst prisma = globalThis.prisma ?? prismaClientSingleton()\n\nif (process.env.NODE_ENV !== \"production\") globalThis.prisma = prisma\n\nexport const db = {\n  event: {\n    create: async (data: any) => {\n      return prisma.event.create({ data })\n    },\n    findUnique: async (where: { id: string }) => {\n      return prisma.event.findUnique({ where })\n    },\n    findMany: async (options?: any) => {\n      return prisma.event.findMany({\n        orderBy: { createdAt: 'desc' },\n        ...options\n      })\n    },\n    update: async (params: { where: { id: string }; data: any }) => {\n      return prisma.event.update({\n        where: params.where,\n        data: params.data,\n      })\n    },\n    findUniqueWithClaims: async (where: { id: string }) => {\n      return prisma.event.findUnique({\n        where,\n        include: { claimedSeats: true },\n      })\n    },\n    findManyWithClaims: async () => {\n      return prisma.event.findMany({\n        include: { claimedSeats: true },\n        orderBy: { createdAt: 'desc' },\n      })\n    },\n  },\n  claimedSeat: {\n    create: async (data: any) => {\n      return prisma.claimedSeat.create({ data })\n    },\n    findFirst: async (where: any) => {\n      return prisma.claimedSeat.findFirst({ where })\n    },\n  },\n}\n"],"names":[],"mappings":";;;;AAAA;;AAEA,MAAM,wBAAwB;IAC5B,OAAO,IAAI,+JAAY;AACzB;AAMA,MAAM,SAAS,WAAW,MAAM,IAAI;AAEpC,wCAA2C,WAAW,MAAM,GAAG;AAExD,MAAM,KAAK;IAChB,OAAO;QACL,QAAQ,OAAO;YACb,OAAO,OAAO,KAAK,CAAC,MAAM,CAAC;gBAAE;YAAK;QACpC;QACA,YAAY,OAAO;YACjB,OAAO,OAAO,KAAK,CAAC,UAAU,CAAC;gBAAE;YAAM;QACzC;QACA,UAAU,OAAO;YACf,OAAO,OAAO,KAAK,CAAC,QAAQ,CAAC;gBAC3B,SAAS;oBAAE,WAAW;gBAAO;gBAC7B,GAAG,OAAO;YACZ;QACF;QACA,QAAQ,OAAO;YACb,OAAO,OAAO,KAAK,CAAC,MAAM,CAAC;gBACzB,OAAO,OAAO,KAAK;gBACnB,MAAM,OAAO,IAAI;YACnB;QACF;QACA,sBAAsB,OAAO;YAC3B,OAAO,OAAO,KAAK,CAAC,UAAU,CAAC;gBAC7B;gBACA,SAAS;oBAAE,cAAc;gBAAK;YAChC;QACF;QACA,oBAAoB;YAClB,OAAO,OAAO,KAAK,CAAC,QAAQ,CAAC;gBAC3B,SAAS;oBAAE,cAAc;gBAAK;gBAC9B,SAAS;oBAAE,WAAW;gBAAO;YAC/B;QACF;IACF;IACA,aAAa;QACX,QAAQ,OAAO;YACb,OAAO,OAAO,WAAW,CAAC,MAAM,CAAC;gBAAE;YAAK;QAC1C;QACA,WAAW,OAAO;YAChB,OAAO,OAAO,WAAW,CAAC,SAAS,CAAC;gBAAE;YAAM;QAC9C;IACF;AACF"}},
    {"offset": {"line": 203, "column": 0}, "map": {"version":3,"sources":["file:///home/zen/Downloads/event-platform-build/lib/pdf-generator.ts"],"sourcesContent":["import { jsPDF } from \"jspdf\"\nimport QRCode from \"qrcode\"\nimport fs from \"fs\"\nimport path from \"path\"\n\nexport async function generateTicketPDF(\n  eventTitle: string,\n  seatInfo: string,\n  eventDate: string,\n  eventTime: string,\n  location: string,\n  ticketId: string,\n  attendeeName?: string\n): Promise<Buffer> {\n  // Generate QR code\n  const qrCodeData = await QRCode.toDataURL(ticketId)\n\n  // Create PDF - Portrait A4\n  const pdf = new jsPDF({\n    orientation: \"portrait\",\n    unit: \"mm\",\n    format: \"a4\",\n  })\n\n  // WHITE BACKGROUND\n  pdf.setFillColor(255, 255, 255)\n  pdf.rect(0, 0, 210, 297, \"F\")\n\n  // Ticket Dimensions\n  const startX = 15\n  const startY = 30\n  const width = 180\n  const height = 90\n  const leftWidth = width * 0.7\n  const rightWidth = width * 0.3\n\n  // Draw Main Card Shadow (simulated with gray rect)\n  pdf.setFillColor(240, 240, 240)\n  pdf.rect(startX + 2, startY + 2, width, height, \"F\")\n\n  // Draw Main Card Background (White)\n  pdf.setFillColor(255, 255, 255)\n  pdf.rect(startX, startY, width, height, \"F\")\n  \n  // Draw Right Section Background (Light Gray)\n  pdf.setFillColor(248, 250, 252) // #f8fafc\n  pdf.rect(startX + leftWidth, startY, rightWidth, height, \"F\")\n\n  // Draw Border\n  pdf.setDrawColor(226, 232, 240) // #e2e8f0\n  pdf.setLineWidth(0.5)\n  pdf.rect(startX, startY, width, height)\n  \n  // Draw Dashed Line Separator\n  pdf.setDrawColor(226, 232, 240)\n  pdf.setLineDashPattern([2, 2], 0)\n  pdf.line(startX + leftWidth, startY, startX + leftWidth, startY + height)\n  pdf.setLineDashPattern([], 0) // Reset\n\n  // --- LEFT SECTION CONTENT ---\n\n  // Initials Box\n  const initials = eventTitle.split(' ').filter(w => w.length > 0).slice(0, 2).map(w => w[0]).join('').toUpperCase() || 'EV'\n  \n  pdf.setFillColor(37, 99, 235) // #2563eb (Blue)\n  pdf.roundedRect(startX + 10, startY + 10, 15, 15, 2, 2, \"F\")\n  \n  pdf.setTextColor(255, 255, 255)\n  pdf.setFontSize(14)\n  pdf.setFont(\"helvetica\", \"bold\")\n  pdf.text(initials, startX + 17.5, startY + 19.5, { align: \"center\" })\n\n  // Event Title\n  pdf.setTextColor(17, 24, 39) // #111827\n  pdf.setFontSize(16)\n  pdf.setFont(\"helvetica\", \"bold\")\n  const titleLines = pdf.splitTextToSize(eventTitle, leftWidth - 40)\n  pdf.text(titleLines, startX + 35, startY + 16)\n\n  // Grid Info\n  const gridY = startY + 40\n  const colWidth = (leftWidth - 20) / 3\n\n  // Labels style\n  const labelColor = [156, 163, 175] // #9ca3af\n  const valueColor = [31, 41, 55] // #1f2937\n  \n  const drawField = (label: string, value: string | string[], x: number, y: number) => {\n    pdf.setTextColor(156, 163, 175)\n    pdf.setFontSize(8)\n    pdf.setFont(\"helvetica\", \"bold\")\n    pdf.text(label, x, y)\n    \n    pdf.setTextColor(31, 41, 55)\n    pdf.setFontSize(10)\n    pdf.setFont(\"helvetica\", \"bold\")\n    \n    if (Array.isArray(value)) {\n      value.forEach((v, i) => pdf.text(v, x, y + 5 + (i * 4)))\n    } else {\n      pdf.text(value, x, y + 5)\n    }\n  }\n\n  // WHEN\n  drawField(\"WHEN\", [eventDate, eventTime], startX + 10, gridY)\n  \n  // WHERE\n  const locationLines = pdf.splitTextToSize(location, colWidth - 5)\n  drawField(\"WHERE\", locationLines, startX + 10 + colWidth, gridY)\n  \n  // SEAT\n  drawField(\"SEAT\", seatInfo, startX + 10 + (colWidth * 2), gridY)\n\n  // ATTENDEE\n  if (attendeeName) {\n    drawField(\"ATTENDEE\", attendeeName, startX + 10, gridY + 20)\n  }\n\n  // Footer Text\n  pdf.setTextColor(156, 163, 175)\n  pdf.setFontSize(7)\n  pdf.setFont(\"helvetica\", \"normal\")\n  pdf.text(\"Present this ticket on arrival. This ticket is valid for one entry.\", startX + 10, startY + height - 10)\n\n  // --- RIGHT SECTION CONTENT ---\n\n  const rightCenterX = startX + leftWidth + (rightWidth / 2)\n\n  // GENERAL Label\n  pdf.setTextColor(100, 116, 139) // #64748b\n  pdf.setFontSize(8)\n  pdf.setFont(\"helvetica\", \"bold\")\n  pdf.text(\"GENERAL\", rightCenterX, startY + 15, { align: \"center\" })\n\n  // QR Code\n  pdf.addImage(qrCodeData, \"PNG\", rightCenterX - 15, startY + 22, 30, 30)\n\n  // Ticket ID Label\n  pdf.setTextColor(156, 163, 175)\n  pdf.setFontSize(7)\n  pdf.setFont(\"helvetica\", \"bold\")\n  pdf.text(\"TICKET ID\", rightCenterX, startY + 60, { align: \"center\" })\n\n  // Ticket ID Value\n  pdf.setTextColor(71, 85, 105) // #475569\n  pdf.setFontSize(8)\n  pdf.setFont(\"courier\", \"normal\")\n  pdf.text(ticketId, rightCenterX, startY + 64, { align: \"center\" })\n\n  // Fake Barcode\n  const barcodeY = startY + 72\n  const barcodeHeight = 10\n  const barcodeWidth = 40\n  const barcodeX = rightCenterX - (barcodeWidth / 2)\n  \n  pdf.setFillColor(51, 65, 85) // #334155\n  \n  // Draw random lines to simulate barcode\n  let currentX = barcodeX\n  while (currentX < barcodeX + barcodeWidth) {\n    const lineWidth = Math.random() * 1.5 + 0.5\n    if (currentX + lineWidth > barcodeX + barcodeWidth) break\n    \n    // Random gap\n    if (Math.random() > 0.3) {\n      pdf.rect(currentX, barcodeY, lineWidth, barcodeHeight, \"F\")\n    }\n    currentX += lineWidth + (Math.random() * 1)\n  }\n\n  return Buffer.from(pdf.output(\"arraybuffer\"))\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 365, "column": 0}, "map": {"version":3,"sources":["file:///home/zen/Downloads/event-platform-build/lib/email.tsx"],"sourcesContent":["import fs from \"fs\"\n\nimport QRCode from \"qrcode\"\n\nconst RESEND_API_URL = \"https://api.resend.com/emails\"\n\ninterface EventDetails {\n  title: string\n  date: string\n  time: string\n  location: string\n  image?: string | null\n}\n\nexport async function sendTicketEmail(to: string, ticketPath: string, event: EventDetails, seatInfo: string, ticketId: string) {\n  console.log(`Attempting to send email to ${to} for event ${event.title} via Resend API`)\n\n  const apiKey = process.env.RESEND_API_KEY\n  \n  if (!apiKey || apiKey.startsWith(\"re_...\")) {\n    console.warn(\"‚ö†Ô∏è No valid Resend API key found. Email sending is mocked.\")\n    console.log(`\n      [MOCK EMAIL]\n      To: ${to}\n      Subject: Your Ticket for ${event.title}\n      Seat: ${seatInfo}\n      Ticket Path: ${ticketPath}\n      Event: ${event.title}\n      Date: ${event.date} at ${event.time}\n      Location: ${event.location}\n      Image: ${event.image}\n    `)\n    return { id: \"mock-id\" }\n  }\n\n  try {\n    // Generate QR Code for email preview\n    const qrCodeData = await QRCode.toDataURL(ticketId)\n\n    // Read the PDF file and convert to base64\n    const fileBuffer = fs.readFileSync(ticketPath)\n    const base64Content = fileBuffer.toString(\"base64\")\n    const filename = `ticket-${event.title.replace(/\\s+/g, \"-\").toLowerCase()}.pdf`\n\n    // Only attach the PDF\n    const attachments = [\n      {\n        filename: filename,\n        content: base64Content,\n      },\n    ]\n\n    // Generate initials for the event logo\n    const getInitials = (title: string) => {\n      const words = title.split(' ').filter(w => w.length > 0)\n      if (words.length === 0) return 'EV'\n      if (words.length === 1) return words[0].substring(0, 2).toUpperCase()\n      return (words[0][0] + words[1][0]).toUpperCase()\n    }\n    const initials = getInitials(event.title)\n\n    // Construct the sender address\n    const senderEmail = process.env.SENDER_EMAIL || \"onboarding@resend.dev\"\n    const senderName = process.env.SENDER_NAME || \"Ticketmaster\"\n    const from = `${senderName} <${senderEmail}>`\n\n    const body = {\n      from,\n      to: [to],\n      subject: `üéüÔ∏è ${event.title} - Seat ${seatInfo}`,\n      html: `\n        <!DOCTYPE html>\n        <html>\n        <body style=\"margin: 0; padding: 0; background-color: #f3f4f6; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;\">\n          <table width=\"100%\" cellpadding=\"0\" cellspacing=\"0\" border=\"0\" style=\"background-color: #f3f4f6; padding: 40px 0;\">\n            <tr>\n              <td align=\"center\">\n                <table width=\"600\" cellpadding=\"0\" cellspacing=\"0\" border=\"0\" style=\"max-width: 600px; width: 100%; font-family: sans-serif;\">\n                  <tr>\n                    <td style=\"padding: 0;\">\n                      \n                      <!-- Ticket Card -->\n                      <table width=\"100%\" cellpadding=\"0\" cellspacing=\"0\" border=\"0\" style=\"background: white; border-radius: 16px; overflow: hidden; box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);\">\n                        <tr>\n                          <!-- Left Section (Main Info) -->\n                          <td width=\"70%\" style=\"padding: 30px; vertical-align: top;\">\n                            \n                            <!-- Header: Initials + Title -->\n                            <table width=\"100%\" cellpadding=\"0\" cellspacing=\"0\" border=\"0\" style=\"margin-bottom: 30px;\">\n                              <tr>\n                                <td width=\"50\" style=\"vertical-align: middle;\">\n                                  <div style=\"width: 48px; height: 48px; background-color: #2563eb; border-radius: 8px; color: white; font-size: 18px; font-weight: 700; line-height: 48px; text-align: center; font-family: sans-serif;\">\n                                    ${initials}\n                                  </div>\n                                </td>\n                                <td style=\"padding-left: 15px; vertical-align: middle;\">\n                                  <h1 style=\"margin: 0; font-size: 20px; font-weight: 700; color: #111827; line-height: 1.2;\">${event.title}</h1>\n                                </td>\n                              </tr>\n                            </table>\n\n                            <!-- Details Grid -->\n                            <table width=\"100%\" cellpadding=\"0\" cellspacing=\"0\" border=\"0\">\n                              <tr>\n                                <td style=\"padding-bottom: 20px; width: 33%; vertical-align: top;\">\n                                  <div style=\"font-size: 10px; font-weight: 700; color: #9ca3af; text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 4px;\">WHEN</div>\n                                  <div style=\"font-size: 12px; font-weight: 600; color: #1f2937;\">${event.date}</div>\n                                  <div style=\"font-size: 12px; font-weight: 600; color: #1f2937;\">${event.time}</div>\n                                </td>\n                                <td style=\"padding-bottom: 20px; width: 33%; vertical-align: top;\">\n                                  <div style=\"font-size: 10px; font-weight: 700; color: #9ca3af; text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 4px;\">WHERE</div>\n                                  <div style=\"font-size: 12px; font-weight: 600; color: #1f2937;\">${event.location}</div>\n                                </td>\n                                <td style=\"padding-bottom: 20px; width: 33%; vertical-align: top;\">\n                                  <div style=\"font-size: 10px; font-weight: 700; color: #9ca3af; text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 4px;\">SEAT</div>\n                                  <div style=\"font-size: 12px; font-weight: 600; color: #1f2937;\">${seatInfo}</div>\n                                </td>\n                              </tr>\n                              <tr>\n                                <td colspan=\"3\" style=\"vertical-align: top;\">\n                                  <div style=\"font-size: 10px; font-weight: 700; color: #9ca3af; text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 4px;\">ATTENDEE</div>\n                                  <div style=\"font-size: 14px; font-weight: 700; color: #1f2937;\">${to.split('@')[0]}</div>\n                                  <div style=\"font-size: 12px; color: #6b7280;\">${to}</div>\n                                </td>\n                              </tr>\n                            </table>\n\n                            <div style=\"margin-top: 25px; font-size: 11px; color: #9ca3af; line-height: 1.4;\">\n                              Present this ticket on arrival. This ticket is valid for one entry. For support contact help@eventhub.com\n                            </div>\n\n                          </td>\n\n                          <!-- Right Section (QR & Barcode) -->\n                          <td width=\"30%\" style=\"background-color: #f8fafc; padding: 30px 20px; text-align: center; border-left: 2px dashed #e2e8f0; vertical-align: middle;\">\n                            \n                            <div style=\"font-size: 10px; font-weight: 600; color: #64748b; text-transform: uppercase; margin-bottom: 15px;\">GENERAL</div>\n                            \n                            <!-- QR Code -->\n                            <img src=\"${qrCodeData}\" alt=\"QR Code\" width=\"100\" height=\"100\" style=\"display: block; margin: 0 auto 15px auto; border-radius: 4px; mix-blend-mode: multiply;\" />\n                            \n                            <!-- Ticket ID -->\n                            <div style=\"margin-bottom: 15px;\">\n                              <div style=\"font-size: 9px; font-weight: 700; color: #9ca3af; text-transform: uppercase; margin-bottom: 2px;\">TICKET ID</div>\n                              <div style=\"font-size: 10px; font-family: monospace; color: #475569;\">${ticketId}</div>\n                            </div>\n\n                            <!-- Fake Barcode -->\n                            <div style=\"height: 35px; width: 100%; background-image: repeating-linear-gradient(90deg, #334155 0, #334155 2px, transparent 2px, transparent 4px, #334155 4px, #334155 5px, transparent 5px, transparent 7px); opacity: 0.8;\"></div>\n                            <div style=\"font-size: 8px; color: #9ca3af; margin-top: 4px; letter-spacing: 2px;\">${ticketId.substring(0, 12)}</div>\n\n                          </td>\n                        </tr>\n                      </table>\n                      \n                      <!-- Footer -->\n                      <div style=\"text-align: center; padding-top: 20px;\">\n                        <p style=\"font-size: 11px; color: #9ca3af; margin: 0;\">\n                          ¬© ${new Date().getFullYear()} EventHub. All rights reserved.\n                        </p>\n                      </div>\n\n                    </td>\n                  </tr>\n                </table>\n              </td>\n            </tr>\n          </table>\n        </body>\n        </html>\n      `,\n      attachments: attachments,\n    }\n\n    const response = await fetch(RESEND_API_URL, {\n      method: \"POST\",\n      headers: {\n        \"Authorization\": `Bearer ${apiKey}`,\n        \"Content-Type\": \"application/json\",\n      },\n      body: JSON.stringify(body),\n    })\n\n    if (!response.ok) {\n      const errorData = await response.json()\n      console.error(\"Resend API Error:\", errorData)\n      throw new Error(`Resend API responded with ${response.status}: ${JSON.stringify(errorData)}`)\n    }\n\n    const data = await response.json()\n    console.log(\"Email sent successfully via Resend:\", data.id)\n    return data\n  } catch (error) {\n    console.error(\"Failed to send email:\", error)\n    return null\n  }\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 554, "column": 0}, "map": {"version":3,"sources":["file:///home/zen/Downloads/event-platform-build/app/api/events/%5Bid%5D/claim-seat/route.ts"],"sourcesContent":["import { type NextRequest, NextResponse } from \"next/server\"\nimport { db } from \"@/lib/db-adapter\"\nimport { generateTicketPDF } from \"@/lib/pdf-generator\"\nimport { sendTicketEmail } from \"@/lib/email\"\nimport fs from \"fs\"\nimport path from \"path\"\n\nexport async function POST(request: NextRequest, { params }: { params: Promise<{ id: string }> }) {\n  const { id } = await params\n  try {\n    const { seatRow, seatNum, email, name } = await request.json()\n\n    const ticketId = `TKT-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`\n\n    const existingClaim = await db.claimedSeat.findFirst({\n      eventId: id,\n      seatRow,\n      seatNum,\n    })\n\n    if (existingClaim) {\n      return NextResponse.json({ error: \"Seat already claimed\" }, { status: 400 })\n    }\n\n    const event = await db.event.findUnique({\n      id,\n    })\n\n    if (!event) {\n      return NextResponse.json({ error: \"Event not found\" }, { status: 404 })\n    }\n\n    const claim = await db.claimedSeat.create({\n      eventId: id,\n      seatRow,\n      seatNum,\n      email,\n      name,\n      ticketId,\n    })\n\n    const seatInfo = `${seatRow}${seatNum}`\n\n    const pdfBuffer = await generateTicketPDF(\n      event.title, \n      seatInfo, \n      event.date, \n      event.time, \n      event.location, \n      ticketId,\n      name\n    )\n\n    const ticketDir = path.join(process.cwd(), \"public\", \"tickets\")\n    if (!fs.existsSync(ticketDir)) {\n      fs.mkdirSync(ticketDir, { recursive: true })\n    }\n\n    const ticketFilePath = path.join(ticketDir, `${ticketId}.pdf`)\n    fs.writeFileSync(ticketFilePath, pdfBuffer)\n\n    // Send email\n    try {\n      await sendTicketEmail(\n        email, \n        ticketFilePath, \n        {\n          title: event.title,\n          date: event.date,\n          time: event.time,\n          location: event.location,\n          image: event.image\n        }, \n        `${seatRow}${seatNum}`,\n        ticketId\n      )\n    } catch (error) {\n      console.error(\"Failed to send email (continuing anyway):\", error)\n      // We don't fail the request if email fails, as the seat is already claimed\n    }\n\n    return NextResponse.json({\n      success: true,\n      ticketId: claim.ticketId,\n      message: \"Seat claimed successfully\",\n    })\n  } catch (error) {\n    console.error(\"Failed to claim seat:\", error) // Updated error message\n    return NextResponse.json({ error: \"Failed to claim seat\" }, { status: 500 })\n  }\n}\n"],"names":[],"mappings":";;;;AAAA;AACA;AACA;AACA;AACA;AACA;;;;;;;AAEO,eAAe,KAAK,OAAoB,EAAE,EAAE,MAAM,EAAuC;IAC9F,MAAM,EAAE,EAAE,EAAE,GAAG,MAAM;IACrB,IAAI;QACF,MAAM,EAAE,OAAO,EAAE,OAAO,EAAE,KAAK,EAAE,IAAI,EAAE,GAAG,MAAM,QAAQ,IAAI;QAE5D,MAAM,WAAW,CAAC,IAAI,EAAE,KAAK,GAAG,GAAG,CAAC,EAAE,KAAK,MAAM,GAAG,QAAQ,CAAC,IAAI,MAAM,CAAC,GAAG,IAAI;QAE/E,MAAM,gBAAgB,MAAM,4HAAE,CAAC,WAAW,CAAC,SAAS,CAAC;YACnD,SAAS;YACT;YACA;QACF;QAEA,IAAI,eAAe;YACjB,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAuB,GAAG;gBAAE,QAAQ;YAAI;QAC5E;QAEA,MAAM,QAAQ,MAAM,4HAAE,CAAC,KAAK,CAAC,UAAU,CAAC;YACtC;QACF;QAEA,IAAI,CAAC,OAAO;YACV,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAkB,GAAG;gBAAE,QAAQ;YAAI;QACvE;QAEA,MAAM,QAAQ,MAAM,4HAAE,CAAC,WAAW,CAAC,MAAM,CAAC;YACxC,SAAS;YACT;YACA;YACA;YACA;YACA;QACF;QAEA,MAAM,WAAW,GAAG,UAAU,SAAS;QAEvC,MAAM,YAAY,MAAM,IAAA,8IAAiB,EACvC,MAAM,KAAK,EACX,UACA,MAAM,IAAI,EACV,MAAM,IAAI,EACV,MAAM,QAAQ,EACd,UACA;QAGF,MAAM,YAAY,4GAAI,CAAC,IAAI,CAAC,QAAQ,GAAG,IAAI,UAAU;QACrD,IAAI,CAAC,wGAAE,CAAC,UAAU,CAAC,YAAY;YAC7B,wGAAE,CAAC,SAAS,CAAC,WAAW;gBAAE,WAAW;YAAK;QAC5C;QAEA,MAAM,iBAAiB,4GAAI,CAAC,IAAI,CAAC,WAAW,GAAG,SAAS,IAAI,CAAC;QAC7D,wGAAE,CAAC,aAAa,CAAC,gBAAgB;QAEjC,aAAa;QACb,IAAI;YACF,MAAM,IAAA,kIAAe,EACnB,OACA,gBACA;gBACE,OAAO,MAAM,KAAK;gBAClB,MAAM,MAAM,IAAI;gBAChB,MAAM,MAAM,IAAI;gBAChB,UAAU,MAAM,QAAQ;gBACxB,OAAO,MAAM,KAAK;YACpB,GACA,GAAG,UAAU,SAAS,EACtB;QAEJ,EAAE,OAAO,OAAO;YACd,QAAQ,KAAK,CAAC,6CAA6C;QAC3D,2EAA2E;QAC7E;QAEA,OAAO,gJAAY,CAAC,IAAI,CAAC;YACvB,SAAS;YACT,UAAU,MAAM,QAAQ;YACxB,SAAS;QACX;IACF,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,yBAAyB,QAAO,wBAAwB;QACtE,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAAuB,GAAG;YAAE,QAAQ;QAAI;IAC5E;AACF"}}]
}