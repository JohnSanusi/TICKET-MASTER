{"version":3,"sources":["../../../lib/db.ts","../../../lib/models.ts","../../../lib/db-adapter.ts"],"sourcesContent":["import mongoose from \"mongoose\"\n\nconst MONGODB_URI = process.env.DATABASE_URL\n\nif (!MONGODB_URI) {\n  throw new Error(\"DATABASE_URL is not defined\")\n}\n\nlet cached = (global as any).mongoose\n\nif (!cached) {\n  cached = (global as any).mongoose = { conn: null, promise: null }\n}\n\nasync function connectDB() {\n  if (cached.conn) {\n    return cached.conn\n  }\n\n  if (!cached.promise) {\n    const opts: mongoose.ConnectOptions = {\n      bufferCommands: false,\n      serverApi: {\n        version: \"1\" as any,\n        strict: true,\n        deprecationErrors: true,\n      },\n    }\n\n    cached.promise = mongoose.connect(MONGODB_URI!, opts).then((mongoose) => {\n      return mongoose\n    })\n  }\n\n  try {\n    cached.conn = await cached.promise\n  } catch (e) {\n    cached.promise = null\n    throw e\n  }\n\n  return cached.conn\n}\n\nexport default connectDB\n","import mongoose from \"mongoose\"\n\nconst eventSchema = new mongoose.Schema({\n  artistName: String,\n  title: { type: String, required: true },\n  description: { type: String, required: true },\n  location: { type: String, required: true },\n  date: { type: String, required: true },\n  time: { type: String, required: true },\n  image: String,\n  seatMap: { type: String, default: \"[]\" },\n  maxTickets: { type: Number, default: 50 },\n  hasTimer: { type: Boolean, default: false },\n  eventDate: String,\n  eventTime: String,\n}, { timestamps: true })\n\nconst claimedSeatSchema = new mongoose.Schema({\n  eventId: { type: String, required: true },\n  seatRow: { type: String, required: true },\n  seatNum: { type: Number, required: true },\n  email: { type: String, required: true },\n  name: { type: String, required: true },\n  section: String,\n  ticketType: String,\n  level: String,\n  ticketId: { type: String, required: true, unique: true },\n}, { timestamps: true })\n\nexport const Event = mongoose.models.Event || mongoose.model(\"Event\", eventSchema)\nexport const ClaimedSeat = mongoose.models.ClaimedSeat || mongoose.model(\"ClaimedSeat\", claimedSeatSchema)\n","import connectDB from \"./db\"\nimport { Event, ClaimedSeat } from \"./models\"\n\n// Helper to convert mongoose doc to object with id\nconst toObject = (doc: any) => {\n  if (!doc) return null\n  const obj = doc.toObject ? doc.toObject() : doc\n  if (obj._id) {\n    obj.id = obj._id.toString()\n    delete obj._id\n    delete obj.__v\n  }\n  return JSON.parse(JSON.stringify(obj))\n}\n\nexport const db = {\n  event: {\n    create: async (data: any) => {\n      await connectDB()\n      const event = await Event.create(data)\n      return toObject(event)\n    },\n    findUnique: async (where: { id: string }) => {\n      await connectDB()\n      const event = await Event.findById(where.id)\n      return toObject(event)\n    },\n    findMany: async (options?: any) => {\n      await connectDB()\n      const events = await Event.find().sort({ createdAt: -1 })\n      return events.map(toObject)\n    },\n    update: async (params: { where: { id: string }; data: any }) => {\n      await connectDB()\n      const event = await Event.findByIdAndUpdate(params.where.id, params.data, { new: true })\n      return toObject(event)\n    },\n    delete: async (where: { id: string }) => {\n      await connectDB()\n      const event = await Event.findByIdAndDelete(where.id)\n      return toObject(event)\n    },\n    findUniqueWithClaims: async (where: { id: string }) => {\n      await connectDB()\n      const event = await Event.findById(where.id)\n      if (!event) return null\n      \n      const claimedSeats = await ClaimedSeat.find({ eventId: where.id })\n      const eventObj = toObject(event)\n      eventObj.claimedSeats = claimedSeats.map(toObject)\n      return eventObj\n    },\n    findManyWithClaims: async () => {\n      await connectDB()\n      const events = await Event.find().sort({ createdAt: -1 })\n      const eventsWithClaims = await Promise.all(\n        events.map(async (event) => {\n          const claimedSeats = await ClaimedSeat.find({ eventId: event._id.toString() })\n          const eventObj = toObject(event)\n          eventObj.claimedSeats = claimedSeats.map(toObject)\n          return eventObj\n        })\n      )\n      return eventsWithClaims\n    },\n  },\n  claimedSeat: {\n    create: async (data: any) => {\n      await connectDB()\n      const claim = await ClaimedSeat.create(data)\n      return toObject(claim)\n    },\n    findFirst: async (where: any) => {\n      await connectDB()\n      const claim = await ClaimedSeat.findOne(where)\n      return toObject(claim)\n    },\n  },\n}\n"],"names":[],"mappings":"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"}