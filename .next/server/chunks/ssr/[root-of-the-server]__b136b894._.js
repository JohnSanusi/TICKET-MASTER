module.exports=[26046,(a,b,c)=>{b.exports=a.x("mongoose",()=>require("mongoose"))},37936,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),Object.defineProperty(c,"registerServerReference",{enumerable:!0,get:function(){return d.registerServerReference}});let d=a.r(11857)},13095,(a,b,c)=>{"use strict";function d(a){for(let b=0;b<a.length;b++){let c=a[b];if("function"!=typeof c)throw Object.defineProperty(Error(`A "use server" file can only export async functions, found ${typeof c}.
Read more: https://nextjs.org/docs/messages/invalid-use-server-value`),"__NEXT_ERROR_CODE",{value:"E352",enumerable:!1,configurable:!0})}}Object.defineProperty(c,"__esModule",{value:!0}),Object.defineProperty(c,"ensureServerEntryExports",{enumerable:!0,get:function(){return d}})},30072,a=>{"use strict";var b=a.i(37936),c=a.i(26046);let d=process.env.DATABASE_URL;if(!d)throw Error("DATABASE_URL is not defined");let e=a.g.mongoose;async function f(){if(e.conn)return e.conn;e.promise||(e.promise=c.default.connect(d,{bufferCommands:!1,serverApi:{version:"1",strict:!0,deprecationErrors:!0}}).then(a=>a));try{e.conn=await e.promise}catch(a){throw e.promise=null,a}return e.conn}e||(e=a.g.mongoose={conn:null,promise:null});let g=new c.default.Schema({artistName:String,title:{type:String,required:!0},description:{type:String,required:!0},location:{type:String,required:!0},date:{type:String,required:!0},time:{type:String,required:!0},image:String,seatMap:{type:String,default:"[]"},maxTickets:{type:Number,default:50},hasTimer:{type:Boolean,default:!1},eventDate:String,eventTime:String},{timestamps:!0}),h=new c.default.Schema({eventId:{type:String,required:!0},seatRow:{type:String,required:!0},seatNum:{type:Number,required:!0},email:{type:String,required:!0},name:{type:String,required:!0},section:String,ticketType:String,level:String,ticketId:{type:String,required:!0,unique:!0}},{timestamps:!0}),i=c.default.models.Event||c.default.model("Event",g),j=c.default.models.ClaimedSeat||c.default.model("ClaimedSeat",h),k=a=>{if(!a)return null;let b=a.toObject?a.toObject():a;return b._id&&(b.id=b._id.toString(),delete b._id,delete b.__v),JSON.parse(JSON.stringify(b))},l=async a=>(await f(),k(await i.create(a))),m=async a=>(await f(),k(await i.findByIdAndUpdate(a.where.id,a.data,{new:!0}))),n=async a=>(await f(),k(await i.findByIdAndDelete(a.id))),o=async a=>{await f();let b=await i.findById(a.id);if(!b)return null;let c=await j.find({eventId:a.id}),d=k(b);return d.claimedSeats=c.map(k),d},p=async()=>{await f();let a=await i.find().sort({createdAt:-1});return await Promise.all(a.map(async a=>{let b=await j.find({eventId:a._id.toString()}),c=k(a);return c.claimedSeats=b.map(k),c}))},q=async a=>(await f(),k(await j.create(a))),r=async a=>(await f(),k(await j.findOne(a))),s=["A","B","C","D","E","F","G","H","I","J"];async function t(a){try{console.log("[Server Action] Creating event with data:",a);let b=function(a=50){let b=[],c=Math.ceil(a/s.length),d=a;for(let a of s){if(d<=0)break;let e=Math.min(c,d);for(let c=1;c<=e;c++)b.push({row:a,num:c,available:!0});d-=e}return b}(a.maxTickets||50),c=await l({artistName:a.artistName||null,title:a.title,description:a.description,location:a.location,date:a.date,time:a.time,image:a.image||null,seatMap:JSON.stringify(b),maxTickets:a.maxTickets||50,hasTimer:a.hasTimer||!1,eventDate:a.eventDate||null,eventTime:a.eventTime||null});return console.log("[Server Action] Event created successfully:",c),c}catch(a){throw console.error("[Server Action] Error creating event:",a),a}}async function u(a,b,c){return await m({where:{id:a},data:{eventDate:b,eventTime:c,hasTimer:!0}})}async function v(a,b,c,d,e){let f=`TKT-${Date.now()}-${Math.random().toString(36).substr(2,9)}`;if(await r({eventId:a,seatRow:b,seatNum:c}))throw Error("Seat already claimed");return await q({eventId:a,seatRow:b,seatNum:c,email:d,name:e,ticketId:f})}async function w(a){return await o({id:a})}async function x(){try{return await p()}catch(a){return console.error("Failed to fetch events:",a),[]}}async function y(a){try{return await n({id:a}),{success:!0}}catch(a){return console.error("Failed to delete event:",a),{success:!1,error:"Failed to delete event"}}}(0,a.i(13095).ensureServerEntryExports)([t,u,v,w,x,y]),(0,b.registerServerReference)(t,"401b73206a0ddefb89029d23d1c0932daaa79ce402",null),(0,b.registerServerReference)(u,"70b65ae6490ce549e9724b966089305ab0c0c18c8a",null),(0,b.registerServerReference)(v,"7c9c2929a3363c902ba8f99630ed9f11bc08ef4060",null),(0,b.registerServerReference)(w,"40bda02e207a1fccc9b21becabb299ff49ed9f3710",null),(0,b.registerServerReference)(x,"00cca0bed949ff7093ff3c5fde4d3d82cdbd5c3f65",null),(0,b.registerServerReference)(y,"40e52b96d98da03514f4533da52bd4a94d0912228d",null),a.s(["addTimerToEvent",()=>u,"claimSeat",()=>v,"createEvent",()=>t,"deleteEvent",()=>y,"getAllEvents",()=>x,"getEventById",()=>w],30072)},58468,a=>{"use strict";var b=a.i(30072);a.s([],28893),a.i(28893),a.s(["00cca0bed949ff7093ff3c5fde4d3d82cdbd5c3f65",()=>b.getAllEvents,"401b73206a0ddefb89029d23d1c0932daaa79ce402",()=>b.createEvent,"40bda02e207a1fccc9b21becabb299ff49ed9f3710",()=>b.getEventById,"40e52b96d98da03514f4533da52bd4a94d0912228d",()=>b.deleteEvent,"70b65ae6490ce549e9724b966089305ab0c0c18c8a",()=>b.addTimerToEvent,"7c9c2929a3363c902ba8f99630ed9f11bc08ef4060",()=>b.claimSeat],58468)}];

//# sourceMappingURL=%5Broot-of-the-server%5D__b136b894._.js.map